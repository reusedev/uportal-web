<div class="container">
  <nz-spin [nzSpinning]="loading">
    <form [formGroup]="priceForm">
      <div formArrayName="price_list" class="space-y-4">
        @for (priceItem of priceList.controls; track $index) {
        <div [formGroupName]="$index" class="p-4 bg-gray-50 rounded-lg border border-gray-200">
          <div class="flex items-start justify-between mb-3">
            <div class="text-sm font-medium text-gray-700">价格 {{ $index + 1 }}</div>
            <button
              nz-button
              nzType="text"
              nzDanger
              nzSize="small"
              (click)="removePriceItem($index)"
              [disabled]="priceList.length === 1">
              <span class="ri-delete-bin-line"></span>
            </button>
          </div>

          <div class="space-y-3">
            <div>
              <label class="block text-sm text-gray-600 mb-1">价格</label>
              <nz-input-number
                formControlName="price"
                [nzMin]="0"
                [nzStep]="0.01"
                [nzPlaceHolder]="'请输入价格'"
                [nzFormatter]="priceFormatter"
                [nzParser]="priceParser"
                class="w-full">
              </nz-input-number>
              @if (priceItem.get('price')?.invalid && priceItem.get('price')?.touched) {
              <div class="text-xs text-red-500 mt-1">请输入有效价格</div>
              }
            </div>

            <div>
              <label class="block text-sm text-gray-600 mb-1">价格文案</label>
              <input
                nz-input
                formControlName="price_text"
                placeholder="例如：默认方案、高清大图等"
              />
              @if (priceItem.get('price_text')?.invalid && priceItem.get('price_text')?.touched) {
              <div class="text-xs text-red-500 mt-1">请输入价格文案</div>
              }
            </div>
          </div>
        </div>
        }
      </div>

      <!-- 添加按钮 -->
      <button
        nz-button
        nzType="dashed"
        nzBlock
        (click)="addPriceItem()"
        class="mt-4">
        <span class="ri-add-line mr-1"></span>
        继续添加
      </button>
    </form>
  </nz-spin>
</div>

<div class="button">
  <button [disabled]="loading" (click)="close()" nz-button nzType="default" nzSize="default">取消</button>
  <button [disabled]="loading" (click)="save()" nz-button nzType="primary" nzSize="default">保存</button>
</div>

